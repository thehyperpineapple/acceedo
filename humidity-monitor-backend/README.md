# humidity-monitor-backend

### Install dependances
```
npm -i
```
### Run Application
```
nodemon server.js
```

## Environment Variables
#### Create a `.env` file to hold the following environment variables
```
# Server Configuration
PORT=

# MongoDB Configuration
MONGO_URI=

# JWT Configuration
JWT_SECRET=
```
## Routes

### Description of Routes and Their Usage
**Base URL for testing**: `http://localhost:3000/`

| HTTP Method | Function              | Route                             | Description                                                                                         | Parameters                                                                                                                                                                                                                                                                     | Payload (JSON)                                                                                                                                                                                                                                               |
|-------------|-----------------------|-----------------------------------|-----------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `POST`      | External Services     | `/external/createServer`          | Creates a collection named `Board_{unit_ID}` and adds the initial document. Returns an error if it already exists.                      | `unit_ID` (required in body)                                                                                                                                                                                                                                                  | `{ "unit_ID": 1, "t": 40, "h": 10, "w": 930, "eb": 11, "ups": 1, "x": 5, "y": 10 }`                                                                                                                                                                           |
| `PUT`       | External Services     | `/external/updateServer`          | Adds a new document to the collection named `Board_{unit_ID}` with the provided data.                                                    | `unit_ID` (required in query)                                                                                                                                                                                                                                                 | `{ "t": 45, "h": 15, "w": 950, "eb": 12, "ups": 1, "x": 6, "y": 12 }`                                                                                                                                                                                        |
| `DELETE`    | External Services     | `/external/deleteServer`          | Deletes the collection named `Board_{unit_ID}`.                                                                                          | `unit_ID` (required in query)                                                                                                                                                                                                                                                 | None                                                                                                                                                                                                                                                         |
| `POST`      | User Authentication   | `/auth/login`                     | Authenticates a user and returns a token if the credentials are valid.                                                                   | None                                                                                                                                                                                                                                                                           | `{ "username": "user1", "password": "password123" }`                                                                                                                                                                                                         |
| `POST`      | User Authentication   | `/auth/createUser`                | Creates a new user in the system.                                                                                                         | None                                                                                                                                                                                                                                                                           | `{ "user_ID": "u123", "username": "newuser", "password": "pass123", "emailId": "user@example.com", "phoneNo": "1234567890", "role": "admin" }`                                                                                                               |
| `GET`       | User Authentication   | `/auth/viewUsers`                 | Retrieves a list of all users.                                                                                                           | None                                                                                                                                                                                                                                                                           | None                                                                                                                                                                                                                                                         |
| `DELETE`    | User Authentication   | `/auth/deleteUser/:userId`        | Deletes a specific user by `userId`.                                                                                                     | `userId` (required as path parameter)                                                                                                                                                                                                                                         | None                                                                                                                                                                                                                                                         |
| `PUT`       | User Authentication   | `/auth/updateUser/:userId`        | Updates a user's information by `userId`.                                                                                                | `userId` (required as path parameter)                                                                                                                                                                                                                                         | `{ "username": "updatedUser", "password": "updatedPass", "emailId": "updated@example.com", "phoneNo": "9876543210", "role": "admin" }`                                                                                                                       |
| `POST`      | User Authentication   | `/auth/logout`                    | Invalidates the user's token and logs them out.                                                                                          | None                                                                                                                                                                                                                                                                           | `{ "token": "valid.jwt.token" }`                                                                                                                                                                                                                             |
| `GET`       | Settings              | `/settings/getSettings`           | Fetches settings for all units or a specific unit if `unit_ID` is provided.                                                              | `unit_ID` (optional as query parameter)                                                                                                                                                                                                                                       | None                                                                                                                                                                                                                                                         |
| `POST`      | Settings              | `/settings/addSettings`           | Adds a new setting to the database. All fields are required.                                                                              | None                                                                                                                                                                                                                                                                           | `{ "unit_ID": 1, "humidity_high": 80, "humidity_low": 20, "temp_high": 40, "temp_low": 10, "water_level_high": 500, "water_level_low": 50 }`                                                                                                                  |
| `DELETE`    | Settings              | `/settings/deleteSetting`         | Deletes settings for a specific `unit_ID`.                                                                                               | `unit_ID` (required as query parameter)                                                                                                                                                                                                                                       | None                                                                                                                                                                                                                                                         |
| `GET`       | Report and Graph      | `/report/generateReport`          | Generates a report for the specified `unit_ID` with optional start and end dates. Supports generating PDF or CSV files based on request. | `unit_ID` (required as query parameter), `start_date` (optional as query parameter), `end_date` (optional as query parameter), `format` (`pdf` or `csv`, required as query parameter)                                                                                         | None                                                                                                                                                                                                                                                         |
| `GET`       | Report and Graph      | `/graph/generateGraphs`           | Generates a graph for the specified `unit_ID`. Data is fetched based on optional start and end dates.                                    | `unit_ID` (required as query parameter), `start_date` (optional as query parameter), `end_date` (optional as query parameter)                                                                                                                                                 | None                                                                                                                                                                                                                                                         |

